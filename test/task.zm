
import test_page;
import defs;
import shuffle;
import instructions;
import test_page;

Block test
{
    on_event:entry()
    {
        if (SHUFFLE_PRAC_ITEMS)
        {
            if (shuffle_test_items(prac_items) != OK)
                terminate;
        }
        if (SHUFFLE_TEST_ITEMS)
        {
            if (shuffle_test_items(test_items) != OK)
                terminate;
        }
    }

    Part 
    {
        on_event:entry()
        {
            blank_page.action_auto(this, BLANK_DURATION);
        }
    }

    Part practice_instructions
    {
        on_event:entry()
        {
            pause_page.set_text(PRAC_INSTRUCTION, true);
            pause_page.action(this);
            control.button_box.enable_all_buttons(CONTINUE);
        }
    }


    Part 
    {
        on_event:entry()
        {
            blank_page.action_auto(this, BLANK_DURATION);
        }
    }

    Block practice
    {
        on_event:entry()
        {
            test_page.setup();
            num_cycles = prac_items.size;
        }

        on_event:exit()
        {
            // save data
        }

        Trial
        {
            on_event:entry()
            {
                TestItem item = prac_items[practice.cycle];
                test_page.action(this, item, reference_time);
            }
        }
    }

    Part 
    {
        on_event:entry()
        {
            blank_page.action_auto(this, BLANK_DURATION);
        }
    }
    
    Part test_instructions
    {
        on_event:entry()
        {
            pause_page.set_text(TEST_INSTRUCTION, true);
            pause_page.action(this);
            control.button_box.enable_all_buttons(CONTINUE);
        }
    }
    
    Part 
    {
        on_event:entry()
        {
            blank_page.action_auto(this, BLANK_DURATION);
        }
    }

//    Block test_trials
//    {
//    }

    Part 
    {
        on_event:entry()
        {
            blank_page.action_auto(this, BLANK_DURATION);
        }
    }
}

void action (Part caller)
{
    // The test block needs to notify the caller when it is ready.
    test.enter(caller);
}
